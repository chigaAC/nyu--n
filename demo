<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Google Drive ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1em; }
    #log { white-space: pre-wrap; background: #f4f4f4; border: 1px solid #ccc; padding: 1em; margin-top: 1em; }
    button { margin-top: 1em; padding: 0.5em 1em; }
  </style>
</head>
<body>

<h2>ğŸ“ Google Drive ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h2>

<button onclick="start()">é–‹å§‹</button>

<pre id="log">ï¼ˆã“ã“ã«ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</pre>

<script>
  // ğŸ”§ ã‚ãªãŸã® API ã‚­ãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„
  const API_KEY = AIzaSyBfpmOJjUQLpYdoOBXP4xz-gXIfoHyIiQQ;
  const CLIENT_ID = 295167116096-sva04gs0vtr6hvof2r1cfdtlqre4ohpb.apps.googleusercontent.com;
  const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
  const SCOPES = "https://www.googleapis.com/auth/drive.file";

  function log(msg) {
    document.getElementById("log").textContent += "\n" + msg;
  }

  async function start() {
    log("â–¶ï¸ åˆæœŸåŒ–é–‹å§‹...");
    try {
      await new Promise((resolve, reject) => {
        gapi.load("client:auth2", { callback: resolve, onerror: reject });
      });
      log("âœ… gapi.load å®Œäº†");

      await gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES,
      });
      log("âœ… gapi.client.init å®Œäº†");

      const authInstance = gapi.auth2.getAuthInstance();
      if (!authInstance.isSignedIn.get()) {
        log("ğŸ”‘ ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’å®Ÿè¡Œä¸­...");
        await authInstance.signIn();
        log("âœ… ã‚µã‚¤ãƒ³ã‚¤ãƒ³å®Œäº†");
      } else {
        log("âœ”ï¸ ã™ã§ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³æ¸ˆã¿");
      }

      const user = authInstance.currentUser.get();
      const profile = user.getBasicProfile();
      log("ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: " + profile.getName());

      // âœ… Drive APIã‚’è©¦ã™
      const response = await gapi.client.drive.files.list({ pageSize: 5 });
      const files = response.result.files;
      if (files && files.length > 0) {
        log("ğŸ“„ æœ€è¿‘ã®ãƒ•ã‚¡ã‚¤ãƒ«:");
        files.forEach(f => log("- " + f.name));
      } else {
        log("ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
      }

} catch (err) {
  console.error(err);
  log("âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:\n" + (err.message || JSON.stringify(err, null, 2) || "è©³ç´°ãªã—"));
}
  }
</script>

</body>
</html>
